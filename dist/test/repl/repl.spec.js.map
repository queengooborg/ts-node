{"version":3,"file":"repl.spec.js","sourceRoot":"","sources":["../../../src/test/repl/repl.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { context, expect } from '../testlib';\nimport { delay, resetNodeEnvironment, ts } from '../helpers';\nimport semver = require('semver');\nimport {\n  CMD_TS_NODE_WITH_PROJECT_FLAG,\n  ctxTsNode,\n  getStream,\n  TEST_DIR,\n} from '../helpers';\nimport { createExec, createExecTester } from '../exec-helpers';\nimport { upstreamTopLevelAwaitTests } from './node-repl-tla';\nimport {\n  ctxRepl,\n  macroReplNoErrorsAndStdoutContains,\n  macroReplStderrContains,\n} from './helpers';\n\nconst test = context(ctxTsNode).context(ctxRepl);\ntest.runSerially();\ntest.beforeEach(async (t) => {\n  t.teardown(() => {\n    resetNodeEnvironment();\n    // Useful for debugging memory leaks.  Leaving in case I need it again.\n    // global.gc(); // Requires adding nodeArguments: ['--expose-gc'] to ava config\n    // console.dir(process.memoryUsage().heapUsed / 1000 / 1000);\n  });\n});\n\nconst exec = createExec({\n  cwd: TEST_DIR,\n});\n\nconst execTester = createExecTester({\n  cmd: CMD_TS_NODE_WITH_PROJECT_FLAG,\n  exec,\n});\n\ntest('should run REPL when --interactive passed and stdin is not a TTY', async () => {\n  const execPromise = exec(`${CMD_TS_NODE_WITH_PROJECT_FLAG} --interactive`);\n  execPromise.child.stdin!.end('console.log(\"123\")\\n');\n  const { err, stdout } = await execPromise;\n  expect(err).toBe(null);\n  expect(stdout).toBe('> 123\\n' + 'undefined\\n' + '> ');\n});\n\ntest('should echo a value when using the swc transpiler', async () => {\n  const execPromise = exec(\n    `${CMD_TS_NODE_WITH_PROJECT_FLAG} --interactive  --transpiler ts-node/transpilers/swc-experimental`\n  );\n  execPromise.child.stdin!.end('400\\n401\\n');\n  const { err, stdout } = await execPromise;\n  expect(err).toBe(null);\n  expect(stdout).toBe('> 400\\n> 401\\n> ');\n});\n\ntest('REPL has command to get type information', async () => {\n  const execPromise = exec(`${CMD_TS_NODE_WITH_PROJECT_FLAG} --interactive`);\n  execPromise.child.stdin!.end('\\nconst a = 123\\n.type a');\n  const { err, stdout } = await execPromise;\n  expect(err).toBe(null);\n  expect(stdout).toBe(\n    '> undefined\\n' + '> undefined\\n' + '> const a: 123\\n' + '> '\n  );\n});\n\n// Serial because it's timing-sensitive\ntest.serial('REPL can be configured on `start`', async (t) => {\n  const prompt = '#> ';\n\n  const { stdout, stderr } = await t.context.executeInRepl(\n    `const x = 3\\n'done'`,\n    {\n      waitPattern: \"'done'\",\n      registerHooks: true,\n      startInternalOptions: {\n        prompt,\n        ignoreUndefined: true,\n      },\n    }\n  );\n\n  expect(stderr).toBe('');\n  expect(stdout).toBe(`${prompt}${prompt}'done'\\n`);\n});\n\n// Serial because it's timing-sensitive\ntest.serial(\n  'REPL uses a different context when `useGlobal` is false',\n  async (t) => {\n    const { stdout, stderr } = await t.context.executeInRepl(\n      // No error when re-declaring x\n      'const x = 3\\n' +\n        // console.log ouput will end up in the stream and not in test output\n        'console.log(1)\\n',\n      {\n        registerHooks: true,\n        waitPattern: `> undefined\\n> 1\\nundefined\\n> `,\n        startInternalOptions: {\n          useGlobal: false,\n        },\n      }\n    );\n\n    expect(stderr).toBe('');\n    expect(stdout).toBe(`> undefined\\n> 1\\nundefined\\n> `);\n  }\n);\n\n// Serial because it's timing-sensitive\ntest.serial('REPL can be created via API', async (t) => {\n  const { stdout, stderr } = await t.context.executeInRepl(\n    `\\nconst a = 123\\n.type a\\n`,\n    {\n      registerHooks: true,\n      waitPattern: '123\\n> ',\n    }\n  );\n  expect(stderr).toBe('');\n  expect(stdout).toBe(\n    '> undefined\\n' + '> undefined\\n' + '> const a: 123\\n' + '> '\n  );\n});\n\ntest.suite('top level await', ({ context }) => {\n  const compilerOptions = {\n    target: 'es2018',\n  };\n  const test = context(async (t) => {\n    return { executeInTlaRepl };\n\n    function executeInTlaRepl(input: string, waitPattern?: string | RegExp) {\n      return t.context.executeInRepl(\n        input\n          .split('\\n')\n          .map((line) => line.trim())\n          // Restore newline once https://github.com/nodejs/node/pull/39392 is merged\n          .join(''),\n        {\n          registerHooks: true,\n          waitPattern,\n          createServiceOpts: {\n            experimentalReplAwait: true,\n            compilerOptions,\n          },\n          startInternalOptions: { useGlobal: false },\n        }\n      );\n    }\n  });\n\n  if (semver.gte(ts.version, '3.8.0')) {\n    // Serial because it's timing-sensitive\n    test.serial('should allow evaluating top level await', async (t) => {\n      const script = `\n        const x: number = await new Promise((r) => r(1));\n        for await (const x of [1,2,3]) { console.log(x) };\n        for (const x of ['a', 'b']) { await x; console.log(x) };\n        class Foo {}; await 1;\n        function Bar() {}; await 2;\n        const {y} = await ({y: 2});\n        const [z] = await [3];\n        x + y + z;\n      `;\n\n      const { stdout, stderr } = await t.context.executeInTlaRepl(\n        script,\n        '6\\n> '\n      );\n      expect(stderr).toBe('');\n      expect(stdout).toBe('> 1\\n2\\n3\\na\\nb\\n6\\n> ');\n    });\n\n    // Serial because it's timing-sensitive\n    test.serial(\n      'should wait until promise is settled when awaiting at top level',\n      async (t) => {\n        const awaitMs = 500;\n        const script = `\n          const startTime = new Date().getTime();\n          await new Promise((r) => setTimeout(() => r(1), ${awaitMs}));\n          const endTime = new Date().getTime();\n          endTime - startTime;\n        `;\n        const { stdout, stderr } = await t.context.executeInTlaRepl(\n          script,\n          /\\d+\\n/\n        );\n\n        expect(stderr).toBe('');\n\n        const elapsedTimeString = stdout\n          .split('\\n')[0]\n          .replace('> ', '')\n          .trim();\n        expect(elapsedTimeString).toMatch(/^\\d+$/);\n        const elapsedTime = Number(elapsedTimeString);\n        expect(elapsedTime).toBeGreaterThanOrEqual(awaitMs - 50);\n        // When CI is taxed, the time may be *much* greater than expected.\n        // I can't think of a case where the time being *too high* is a bug\n        // that this test can catch.  So I've made this check very loose.\n        expect(elapsedTime).toBeLessThanOrEqual(awaitMs + 10e3);\n      }\n    );\n\n    // Serial because it's timing-sensitive\n    test.serial(\n      'should not wait until promise is settled when not using await at top level',\n      async (t) => {\n        const script = `\n          const startTime = new Date().getTime();\n          (async () => await new Promise((r) => setTimeout(() => r(1), ${5000})))();\n          const endTime = new Date().getTime();\n          endTime - startTime;\n        `;\n        const { stdout, stderr } = await t.context.executeInTlaRepl(\n          script,\n          /\\d+\\n/\n        );\n\n        expect(stderr).toBe('');\n\n        const ellapsedTime = Number(\n          stdout.split('\\n')[0].replace('> ', '').trim()\n        );\n        expect(ellapsedTime).toBeGreaterThanOrEqual(0);\n        // Should ideally be instantaneous; leave wiggle-room for slow CI\n        expect(ellapsedTime).toBeLessThanOrEqual(100);\n      }\n    );\n\n    // Serial because it's timing-sensitive\n    test.serial(\n      'should error with typing information when awaited result has type mismatch',\n      async (t) => {\n        const { stdout, stderr } = await t.context.executeInTlaRepl(\n          'const x: string = await 1',\n          'error'\n        );\n\n        expect(stdout).toBe('> > ');\n        expect(stderr.replace(/\\r\\n/g, '\\n')).toBe(\n          '<repl>.ts(4,7): error TS2322: ' +\n            (semver.gte(ts.version, '4.0.0')\n              ? `Type 'number' is not assignable to type 'string'.\\n`\n              : `Type '1' is not assignable to type 'string'.\\n`) +\n            '\\n'\n        );\n      }\n    );\n\n    // Serial because it's timing-sensitive\n    test.serial(\n      'should error with typing information when importing a file with type errors',\n      async (t) => {\n        const { stdout, stderr } = await t.context.executeInTlaRepl(\n          `const {foo} = await import('./repl/tla-import');`,\n          'error'\n        );\n\n        expect(stdout).toBe('> > ');\n        expect(stderr.replace(/\\r\\n/g, '\\n')).toBe(\n          'repl/tla-import.ts(1,14): error TS2322: ' +\n            (semver.gte(ts.version, '4.0.0')\n              ? `Type 'number' is not assignable to type 'string'.\\n`\n              : `Type '1' is not assignable to type 'string'.\\n`) +\n            '\\n'\n        );\n      }\n    );\n\n    test('should pass upstream test cases', async (t) => {\n      const { tsNodeUnderTest } = t.context;\n      await upstreamTopLevelAwaitTests({ TEST_DIR, tsNodeUnderTest });\n    });\n  } else {\n    test('should throw error when attempting to use top level await on TS < 3.8', async (t) => {\n      expect(t.context.executeInTlaRepl('')).rejects.toThrow(\n        'Experimental REPL await is not compatible with TypeScript versions older than 3.8'\n      );\n    });\n  }\n});\n\ntest.suite(\n  'REPL ignores diagnostics that are annoying in interactive sessions',\n  (test) => {\n    const code = `function foo() {};\\nfunction foo() {return 123};\\nconsole.log(foo());\\n`;\n    const diagnosticMessage = `Duplicate function implementation`;\n    test('interactive repl should ignore them', async (t) => {\n      const { stdout, stderr } = await execTester({\n        flags: '-i',\n        stdin: code,\n      });\n      expect(stdout).not.toContain(diagnosticMessage);\n    });\n    test('interactive repl should not ignore them if they occur in other files', async (t) => {\n      const { stdout, stderr } = await execTester({\n        flags: '-i',\n        stdin: `import './repl-ignored-diagnostics/index.ts';\\n`,\n      });\n      expect(stderr).toContain(diagnosticMessage);\n    });\n    test('[stdin] should not ignore them', async (t) => {\n      const { stdout, stderr } = await execTester({\n        stdin: code,\n        expectError: true,\n      });\n      expect(stderr).toContain(diagnosticMessage);\n    });\n    test('[eval] should not ignore them', async (t) => {\n      const { stdout, stderr } = await execTester({\n        flags: `-e \"${code.replace(/\\n/g, '')}\"`,\n        expectError: true,\n      });\n      expect(stderr).toContain(diagnosticMessage);\n    });\n  }\n);\n\ntest.suite(\n  'REPL inputs are syntactically independent of each other',\n  (test) => {\n    // Serial because they're timing-sensitive\n    test.runSerially();\n\n    test('arithmetic operators are independent of previous values', async (t) => {\n      const { stdout, stderr } = await t.context.executeInRepl(\n        `9\n          + 3\n          7\n          - 3\n          3\n          * 7\\n.break\n          100\n          / 2\\n.break\n          5\n          ** 2\\n.break\n          console.log('done!')\n          `,\n        {\n          registerHooks: true,\n          startInternalOptions: { useGlobal: false },\n          waitPattern: 'done!\\nundefined\\n>',\n        }\n      );\n      expect(stdout).not.toContain('12');\n      expect(stdout).not.toContain('4');\n      expect(stdout).not.toContain('21');\n      expect(stdout).not.toContain('50');\n      expect(stdout).not.toContain('25');\n      expect(stdout).toContain('3');\n      expect(stdout).toContain('-3');\n    });\n\n    test('automatically inserted semicolons do not appear in error messages at the end', async (t) => {\n      const { stdout, stderr } = await t.context.executeInRepl(\n        `(\n          a\n          console.log('done!')`,\n        {\n          registerHooks: true,\n          startInternalOptions: { useGlobal: false },\n          waitPattern: 'done!\\nundefined\\n>',\n        }\n      );\n      expect(stderr).toContain(\"error TS1005: ')' expected.\");\n      expect(stderr).not.toContain(';');\n    });\n\n    test('automatically inserted semicolons do not appear in error messages at the start', async (t) => {\n      const { stdout, stderr } = await t.context.executeInRepl(\n        `)\n          console.log('done!')`,\n        {\n          registerHooks: true,\n          startInternalOptions: { useGlobal: false },\n          waitPattern: 'done!\\nundefined\\n>',\n        }\n      );\n      expect(stderr).toContain(\n        'error TS1128: Declaration or statement expected.'\n      );\n      expect(stderr).toContain(')');\n      expect(stderr).not.toContain(';');\n    });\n\n    test('automatically inserted semicolons do not break function calls', async (t) => {\n      const { stdout, stderr } = await t.context.executeInRepl(\n        `function foo(a: number) {\n              return a + 1;\n          }\n          foo(\n            1\n          )`,\n        {\n          registerHooks: true,\n          startInternalOptions: { useGlobal: false },\n          waitPattern: '2\\n>',\n        }\n      );\n      expect(stderr).toBe('');\n      expect(stdout).toContain('2');\n    });\n\n    test('automatically inserted semicolons do not affect subsequent line numbers', async (t) => {\n      // If first line of input ends in a semicolon, should not add a second semicolon.\n      // That will cause an extra blank line in the compiled output which will\n      // offset the stack line number.\n      const { stdout, stderr } = await t.context.executeInRepl(\n        `1;\n          new Error().stack!.split('\\\\n')[1]\n          console.log('done!')`,\n        {\n          registerHooks: true,\n          startInternalOptions: { useGlobal: false },\n          waitPattern: 'done!',\n        }\n      );\n      expect(stderr).toBe('');\n      expect(stdout).toContain(\":1:1'\\n\");\n    });\n  }\n);\n\ntest.suite('Multiline inputs and RECOVERY_CODES', (test) => {\n  test.runSerially();\n  test(\n    'multiline function args declaration',\n    macroReplNoErrorsAndStdoutContains,\n    `\n      function myFn(\n        a: string,\n        b: string\n      ) {\n        return a + ' ' + b\n      }\n      myFn('test', '!')\n    `,\n    'test !'\n  );\n\n  test(\n    'Conditional recovery codes: this one-liner *should* raise an error; should not be recoverable',\n    macroReplStderrContains,\n    `\n      (a: any) => a = null;\n    `,\n    'error TS',\n    {\n      createServiceOpts: { compilerOptions: { strictNullChecks: false } },\n    }\n  );\n});\n\ntest.suite('REPL works with traceResolution', (test) => {\n  test.serial(\n    'startup traces should print before the prompt appears when traceResolution is enabled',\n    async (t) => {\n      const repl = t.context.createReplViaApi({\n        registerHooks: false,\n        createServiceOpts: {\n          compilerOptions: {\n            traceResolution: true,\n          },\n        },\n      });\n\n      repl.replService.start();\n\n      repl.stdin.end();\n\n      await delay(3e3);\n\n      repl.stdout.end();\n      const stdout = await getStream(repl.stdout);\n\n      expect(stdout).toContain('======== Resolving module');\n      expect(stdout.endsWith('> ')).toBe(true);\n    }\n  );\n\n  test.serial(\n    'traces should NOT appear when traceResolution is not enabled',\n    async (t) => {\n      const { stdout, stderr } = await t.context.executeInRepl('1', {\n        registerHooks: true,\n        startInternalOptions: { useGlobal: false },\n        waitPattern: '1\\n>',\n      });\n      expect(stderr).toBe('');\n      expect(stdout).not.toContain('======== Resolving module');\n    }\n  );\n});\n\ntest.suite('REPL declares types for node built-ins within REPL', (test) => {\n  test.runSerially();\n  test('enabled when typechecking', async (t) => {\n    const { stdout, stderr } = await t.context.executeInRepl(\n      `util.promisify(setTimeout)(\"should not be a string\" as string)\n      type Duplex = stream.Duplex\n      const s = stream\n      'done'`,\n      {\n        registerHooks: true,\n        waitPattern: `done`,\n        startInternalOptions: {\n          useGlobal: false,\n        },\n      }\n    );\n\n    // Assert that we receive a typechecking error about improperly using\n    // `util.promisify` but *not* an error about the absence of `util`\n    expect(stderr).not.toMatch(\"Cannot find name 'util'\");\n    expect(stderr).toMatch(\n      \"Argument of type 'string' is not assignable to parameter of type 'number'\"\n    );\n    // Assert that both types and values can be used without error\n    expect(stderr).not.toMatch(\"Cannot find namespace 'stream'\");\n    expect(stderr).not.toMatch(\"Cannot find name 'stream'\");\n    expect(stdout).toMatch(`done`);\n  });\n\n  test('disabled in transpile-only mode, to avoid breaking third-party SWC transpiler which rejects `declare import` syntax', async (t) => {\n    const { stdout, stderr } = await t.context.executeInRepl(\n      `type Duplex = stream.Duplex\n      const s = stream\n      'done'`,\n      {\n        createServiceOpts: {\n          swc: true,\n        },\n        registerHooks: true,\n        waitPattern: `done`,\n        startInternalOptions: {\n          useGlobal: false,\n        },\n      }\n    );\n\n    // Assert that we do not get errors about `declare import` syntax from swc\n    expect(stdout).toBe(\"> undefined\\n> undefined\\n> 'done'\\n\");\n    expect(stderr).toBe('');\n  });\n});\n\ntest.suite('REPL treats object literals and block scopes correctly', (test) => {\n  test(\n    'repl should treat { key: 123 } as object literal',\n    macroReplNoErrorsAndStdoutContains,\n    '{ key: 123 }',\n    '{ key: 123 }'\n  );\n  test(\n    'repl should treat ({ key: 123 }) as object literal',\n    macroReplNoErrorsAndStdoutContains,\n    '({ key: 123 })',\n    '{ key: 123 }'\n  );\n  test(\n    'repl should treat ({ let v = 0; v; }) as object literal and error',\n    macroReplStderrContains,\n    '({ let v = 0; v; })',\n    semver.satisfies(ts.version, '2.7')\n      ? 'error TS2304'\n      : 'No value exists in scope for the shorthand property'\n  );\n  test(\n    'repl should treat { let v = 0; v; } as block scope',\n    macroReplNoErrorsAndStdoutContains,\n    '{ let v = 0; v; }',\n    '0'\n  );\n  test.suite('extra', (test) => {\n    test.skipIf(semver.satisfies(ts.version, '2.7'));\n    test(\n      'repl should treat { key: 123 }; as block scope',\n      macroReplNoErrorsAndStdoutContains,\n      '{ key: 123 };',\n      '123'\n    );\n    test(\n      'repl should treat {\\\\nkey: 123\\\\n}; as block scope',\n      macroReplNoErrorsAndStdoutContains,\n      '{\\nkey: 123\\n};',\n      '123'\n    );\n    test(\n      'repl should treat { key: 123 }[] as block scope (edge case)',\n      macroReplNoErrorsAndStdoutContains,\n      '{ key: 123 }[]',\n      '[]'\n    );\n  });\n  test.suite('multiline', (test) => {\n    test(\n      'repl should treat {\\\\nkey: 123\\\\n} as object literal',\n      macroReplNoErrorsAndStdoutContains,\n      '{\\nkey: 123\\n}',\n      '{ key: 123 }'\n    );\n    test(\n      'repl should treat ({\\\\nkey: 123\\\\n}) as object literal',\n      macroReplNoErrorsAndStdoutContains,\n      '({\\nkey: 123\\n})',\n      '{ key: 123 }'\n    );\n    test(\n      'repl should treat ({\\\\nlet v = 0;\\\\nv;\\\\n}) as object literal and error',\n      macroReplStderrContains,\n      '({\\nlet v = 0;\\nv;\\n})',\n      semver.satisfies(ts.version, '2.7')\n        ? 'error TS2304'\n        : 'No value exists in scope for the shorthand property'\n    );\n    test(\n      'repl should treat {\\\\nlet v = 0;\\\\nv;\\\\n} as block scope',\n      macroReplNoErrorsAndStdoutContains,\n      '{\\nlet v = 0;\\nv;\\n}',\n      '0'\n    );\n  });\n  test.suite('property access', (test) => {\n    test(\n      'repl should treat { key: 123 }.key as object literal property access',\n      macroReplNoErrorsAndStdoutContains,\n      '{ key: 123 }.key',\n      '123'\n    );\n    test(\n      'repl should treat { key: 123 }[\"key\"] as object literal indexed access',\n      macroReplNoErrorsAndStdoutContains,\n      '{ key: 123 }[\"key\"]',\n      '123'\n    );\n    test(\n      'repl should treat { key: 123 }.foo as object literal non-existent property access',\n      macroReplStderrContains,\n      '{ key: 123 }.foo',\n      \"Property 'foo' does not exist on type\"\n    );\n    test(\n      'repl should treat { key: 123 }[\"foo\"] as object literal non-existent indexed access',\n      macroReplStderrContains,\n      '{ key: 123 }[\"foo\"]',\n      semver.satisfies(ts.version, '2.7')\n        ? 'error TS7017'\n        : \"Property 'foo' does not exist on type\"\n    );\n  });\n});\n"]}